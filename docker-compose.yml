version: '3.9'

services:

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: admission-app
    restart: unless-stopped
    ports:
      - "3000:3000"                     # веб-интерфейс будет доступен по http://localhost:3000
    environment:
      - NODE_ENV=production
      - DB_HOST=db
      - DB_USER=root
      - DB_PASSWORD=my_strong_password_2026   # ← ПОМЕНЯЙТЕ НА СВОЙ БЕЗОПАСНЫЙ ПАРОЛЬ!
      - DB_NAME=admission_db
      - PORT=3000
    depends_on:
      - db
    volumes:
      - ./uploads:/app/uploads           # папка для загруженных файлов
    # logging:
    #   driver: "json-file"
    #   options:
    #     max-size: "10m"
    #     max-file: "3"

  db:
    image: mysql:8.0
    container_name: admission-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: my_strong_password_2026   # ← должен быть ТОТ ЖЕ пароль, что выше!
      MYSQL_DATABASE: admission_db
      TZ: Europe/Moscow                              # можно поменять на свою зону
    volumes:
      - db-data:/var/lib/mysql                       # постоянное хранение данных БД
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql:ro   # ваш файл в корне проекта
    # ports:
    #   - "3306:3306"           # закомментировано → нет конфликта с локальным MySQL
    command: --default-authentication-plugin=mysql_native_password
    # healthcheck отключён, чтобы не было ложных "unhealthy" на первом запуске

volumes:
  db-data:
    name: admission-db-data